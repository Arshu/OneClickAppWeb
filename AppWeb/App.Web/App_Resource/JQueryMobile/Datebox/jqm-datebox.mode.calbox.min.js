/*! CALBOX Mode */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeDateToday:"b",themeDayHigh:"b",themeDatePick:"b",themeDateHigh:"b",themeDateHighAlt:"b",themeDateHighRec:"b",themeDate:"a",calNextMonthIcon:"plus",calPrevMonthIcon:"minus",calHighToday:true,calHighPick:true,calShowDays:true,calOnlyMonth:false,calWeekMode:false,calWeekModeDay:1,calControlGroup:false,calShowWeek:false,calUsePickers:false,calNoHeader:false,calFormatter:false,calYearPickMin:-6,calYearPickMax:6,useTodayButton:false,useTomorrowButton:false,useCollapsedBut:false,highDays:false,highDates:false,highDatesRec:false,highDatesAlt:false,enableDates:false,calDateList:false,calShowDateList:false});a.extend(a.mobile.datebox.prototype,{_cal_gen:function(d,f,l,i,h){var b=0,e=0,k=1,g=1,c=[],m=[],j=false;for(b=0;b<=5;b++){if(j===false){m=[];for(e=0;e<=6;e++){if(b===0&&e<d){if(i===true){m.push([f+(e-d)+1,h-1])}else{m.push(false)}}else{if(b>3&&k>l){if(i===true){m.push([g,h+1]);g++}else{m.push(false)}j=true}else{m.push([k,h]);k++;if(k>l){j=true}}}}c.push(m)}}return c},_cal_check:function(s,m,l,e,h){var r=this,j,c=this.options,b=h.x,g=h.i,f=h.t,q=h.p,n=new this._date(m,l,e,0,0,0,0).getDay(),p=c.blackDatesRec,d=c.highDatesRec,k={ok:true,iso:m+"-"+r._zPad(l+1)+"-"+r._zPad(e),theme:c.themeDate,recok:true,rectheme:false};k.comp=parseInt(k.iso.replace(/-/g,""),10);if(p!==false){for(j=0;j<p.length;j++){if((p[j][0]===-1||p[j][0]===m)&&(p[j][1]===-1||p[j][1]===l)&&(p[j][2]===-1||p[j][2]===e)){k.ok=false}}}if(a.isArray(c.enableDates)&&a.inArray(k.iso,c.enableDates)<0){k.ok=false}else{if(s){if((k.recok!==true)||(c.afterToday&&f.comp()>k.comp)||(c.beforeToday&&f.comp()<k.comp)||(c.notToday&&f.comp()===k.comp)||(c.maxDays!==false&&b.comp()<k.comp)||(c.minDays!==false&&g.comp()>k.comp)||(a.isArray(c.blackDays)&&a.inArray(n,c.blackDays)>-1)||(a.isArray(c.blackDates)&&a.inArray(k.iso,c.blackDates)>-1)){k.ok=false}}}if(a.isArray(c.whiteDates)&&a.inArray(k.iso,c.whiteDates)>-1){k.ok=true}if(k.ok){if(d!==false){for(j=0;j<d.length;j++){if((d[j][0]===-1||d[j][0]===m)&&(d[j][1]===-1||d[j][1]===l)&&(d[j][2]===-1||d[j][2]===e)){k.rectheme=true}}}if(c.calHighPick&&e===q&&(r.d.input.val()!==""||c.defaultValue!==false)){k.theme=c.themeDatePick}else{if(c.calHighToday&&k.comp===f.comp()){k.theme=c.themeDateToday}else{if(a.isArray(c.highDatesAlt)&&(a.inArray(k.iso,c.highDatesAlt)>-1)){k.theme=c.themeDateHighAlt}else{if(a.isArray(c.highDates)&&(a.inArray(k.iso,c.highDates)>-1)){k.theme=c.themeDateHigh}else{if(a.isArray(c.highDays)&&(a.inArray(n,c.highDays)>-1)){k.theme=c.themeDayHigh}else{if(a.isArray(c.highDatesRec)&&k.rectheme===true){k.theme=c.themeDateHighRec}}}}}}}return k}});a.extend(a.mobile.datebox.prototype._build,{calbox:function(){var J,N,y,r,G,x,m,f,O,n,C,M,Q,b,I,g,H=this,K=this.options,P=K.calDateList,d="ui-datebox-",h=H.theDate,z=false,t={},c=H.initDate.copy(),l=H.initDate.copy(),B=(h.copy([0],[0,0,1]).getDay()-H.__("calStartDay")+7)%7,E=h.get(1),u=h.get(0),p=h.getArray(),e=(H.d.input.val()==="")?H._startOffset(H._makeDate(H.d.input.val())):H._makeDate(H.d.input.val()),v=-1,R=new H._date(),F=R.getArray(),q=h.copy([0],[0,0,1]).adj(2,(-1*B)+(H.__("calStartDay")===0?1:0)).getDWeek(4),j=0,D=false,s=false,k=32-H.theDate.copy([0],[0,0,32,13]).getDate(),A=32-H.theDate.copy([0,-1],[0,0,32,13]).getDate(),L=(K.afterToday||K.beforeToday||K.notToday||K.maxDays||K.minDays||K.blackDays||K.blackDates)?true:false;if(typeof H.d.intHTML!=="boolean"){H.d.intHTML.remove();H.d.intHTML=null}H.d.headerText=((H._grabLabel()!==false)?H._grabLabel():H.__("titleDateDialogLabel"));H.d.intHTML=a("<span>");a("<div class='"+d+"gridheader'><div class='"+d+"gridlabel'><h4>"+H._formatter(H.__("calHeaderFormat"),H.theDate)+"</h4></div></div>").appendTo(H.d.intHTML);a("<div class='"+d+"gridplus"+(H.__("isRTL")?"-rtl":"")+"'><a href='#'>"+H.__("nextMonth")+"</a></div>").prependTo(H.d.intHTML.find("."+d+"gridheader")).find("a").addClass("ui-btn-inline ui-link ui-btn ui-btn-"+K.themeDate+" ui-icon-"+K.calNextMonthIcon+" ui-btn-icon-notext ui-shadow ui-corner-all").on(K.clickEventAlt,function(i){i.preventDefault();if(H.calNext){if(H.theDate.getDate()>28){H.theDate.setDate(1)}H._offset("m",1)}});a("<div class='"+d+"gridminus"+(H.__("isRTL")?"-rtl":"")+"'><a href='#'>"+H.__("prevMonth")+"</a></div>").prependTo(H.d.intHTML.find("."+d+"gridheader")).find("a").addClass("ui-btn-inline ui-link ui-btn ui-btn-"+K.themeDate+" ui-icon-"+K.calPrevMonthIcon+" ui-btn-icon-notext ui-shadow ui-corner-all").on(K.clickEventAlt,function(i){i.preventDefault();if(H.calPrev){if(H.theDate.getDate()>28){H.theDate.setDate(1)}H._offset("m",-1)}});if(K.calNoHeader){if(K.calUsePickersIcons){H.d.intHTML.find("."+d+"gridlabel").hide()}else{H.d.intHTML.find("."+d+"gridheader").remove()}}H.calNext=true;H.calPrev=true;if(Math.floor(R.comp()/100)===Math.floor(h.comp()/100)){D=true}if(Math.floor(R.comp()/10000)===Math.floor(h.comp()/10000)){s=true}if(e.comp()===h.comp()){v=e.get(2)}if(K.afterToday&&(D||(s&&F[1]>=p[1]))){H.calPrev=false}if(K.beforeToday&&(D||(s&&F[1]<=p[1]))){H.calNext=false}if(K.minDays!==false){c.adj(2,K.minDays*-1);J=c.getArray();if(p[0]===J[0]&&p[1]<=J[1]){H.calPrev=false}}if(K.maxDays!==false){l.adj(2,K.maxDays);J=c.getArray();if(p[0]===J[0]&&p[1]>=J[1]){H.calNext=false}}if(K.calUsePickers){N=a("<div>");if(K.calNoHeader&&K.calUsePickersIcons){N.addClass("ui-datebox-pickicon")}N.i=a("<fieldset>").appendTo(N);N.a=a("<select>").appendTo(N.i);N.b=a("<select>").appendTo(N.i);for(M=0;M<=11;M++){N.a.append(a("<option value='"+M+"'"+((E===M)?" selected='selected'":"")+">"+H.__("monthsOfYear")[M]+"</option>"))}if(K.calYearPickMin<1){Q=u+K.calYearPickMin}else{if(K.calYearPickMin<1800){Q=u-K.calYearPickMin}else{if(K.calYearPickMin==="NOW"){Q=F[0]}else{Q=K.calYearPickMin}}}if(K.calYearPickMax<1800){b=u+K.calYearPickMax}else{if(K.calYearPickMax==="NOW"){b=F[0]}else{b=K.calYearPickMax}}for(M=Q;M<=b;M++){N.b.append(a("<option value='"+M+"'"+((u===M)?" selected='selected'":"")+">"+M+"</option>"))}N.a.on("change",function(){H.theDate.setD(1,a(this).val());if(H.theDate.get(1)!==parseInt(a(this).val(),10)){H.theDate.setD(2,0)}H.refresh()});N.b.on("change",function(){H.theDate.setD(0,a(this).val());if(H.theDate.get(1)!==parseInt(N.a.val(),10)){H.theDate.setD(2,0)}H.refresh()});N.i.controlgroup({mini:true,type:"horizontal"});N.i.find("select").selectmenu({nativeMenu:true});N.i.find(".ui-controlgroup-controls").css({marginRight:"auto",marginLeft:"auto",width:"100%",display:"table",});N.i.find(".ui-select").first().css({width:"60%"}).end().last().css({width:"40%"});if(K.calNoHeader&&K.calUsePickersIcons){N.i.css({padding:"0 10px 5px 10px"})}N.appendTo(H.d.intHTML)}y=a("<div class='"+d+"grid'>").appendTo(H.d.intHTML);if(K.calShowDays){H._cal_days=H.__("daysOfWeekShort").concat(H.__("daysOfWeekShort"));G=a("<div>",{"class":d+"gridrow"}).appendTo(y);if(K.calControlGroup){G.addClass(d+"gridrow-last")}if(H.__("isRTL")===true){G.css("direction","rtl")}if(K.calShowWeek){a("<div>").addClass(d+"griddate "+d+"griddate-label").appendTo(G)}for(M=0;M<=6;M++){a("<div>").text(H._cal_days[(M+H.__("calStartDay"))%7]).addClass(d+"griddate "+d+"griddate-label").appendTo(G)}}t={i:c,x:l,t:R,p:v};r=H._cal_gen(B,A,k,!K.calOnlyMonth,h.get(1));if(!a.isFunction(K.calFormatter)&&K.calFormatter!==false&&a.isFunction(window[K.calFormatter])){K.calFormatter=window[K.calFormatter]}for(m=0,O=r.length;m<O;m++){C=a("<div>",{"class":d+"gridrow"});if(H.__("isRTL")){C.css("direction","rtl")}if(K.calShowWeek){a("<div>",{"class":d+"griddate "+d+"griddate-empty"}).text("W"+q).css((K.calControlGroup?{"float":"left"}:{})).appendTo(C);q++;if(q>52&&typeof(r[m+1])!=="undefined"){q=new H._date(p[0],p[1],(H.__("calStartDay")===0)?r[m+1][1][0]:r[m+1][0][0],0,0,0,0).getDWeek(4)}}for(f=0,n=r[m].length;f<n;f++){if(K.calWeekMode){j=r[m][K.calWeekModeDay][0]}if(typeof r[m][f]==="boolean"){a("<div>",{"class":d+"griddate "+d+"griddate-empty"}).appendTo(C)}else{z=H._cal_check(L,p[0],r[m][f][1],r[m][f][0],t);if(r[m][f][0]){if(!a.isFunction(K.calFormatter)){I={text:r[m][f][0],"class":""}
}else{g={Year:((r[m][f][1]>11)?u+1:(r[m][f][1]<0)?u-1:u),Month:((r[m][f][1]===12)?0:(r[m][f][1]===-1)?11:r[m][f][1]),Date:r[m][f][0]};g.ISO=g.Year+"-"+H._zPad(g.Month)+"-"+H._zPad(g.Date);g.Comp=parseInt(g.ISO.replace(/-/g,""),10);J=K.calFormatter(g);if(typeof J!=="object"){I={text:J,"class":""}}else{I={text:J.text,"class":J["class"]}}}a("<div>").html(I.text).addClass(d+"griddate ui-corner-all ui-btn").addClass(E===r[m][f][1]?("ui-btn-"+z.theme+(z.ok?"":" ui-state-disabled")):(d+"griddate-empty")).addClass(I["class"]).css((E!==r[m][f][1]&&!K.calOnlyMonth)?{cursor:"pointer"}:{}).data("date",((K.calWeekMode)?j:r[m][f][0])).data("enabled",z.ok).data("month",r[m][((K.calWeekMode)?K.calWeekModeDay:f)][1]).appendTo(C)}}}if(K.calControlGroup){C.controlgroup({type:"horizontal"})}if(m===O-1){C.addClass(d+"gridrow-last")}C.appendTo(y)}if(K.calShowWeek){y.find("."+d+"griddate").addClass(d+"griddate-week")}if(K.calShowDateList&&P!==false){x=a("<div>");x.a=a("<select name='pickdate'></select>").appendTo(x);x.a.append("<option value='false' selected='selected'>"+H.__("calDateListLabel")+"</option>");for(M=0;M<P.length;M++){x.a.append(a("<option value='"+P[M][0]+"'>"+P[M][1]+"</option>"))}x.a.on("change",function(){J=a(this).val().split("-");H.theDate=new H._date(J[0],J[1]-1,J[2],0,0,0,0);H._t({method:"doset"})});x.find("select").selectmenu({mini:true,nativeMenu:true});x.appendTo(y)}if(K.useTodayButton||K.useTomorrowButton||K.useClearButton){C=a("<div>",{"class":d+"controls"});if(K.useTodayButton){a("<a href='#' role='button'>"+H.__("calTodayButtonLabel")+"</a>").appendTo(C).addClass("ui-btn ui-btn-"+K.theme+" ui-icon-navigation ui-btn-icon-left ui-shadow ui-corner-all").on(K.clickEvent,function(i){i.preventDefault();H.theDate=H._pa([0,0,0],new H._date());H._t({method:"doset"})})}if(K.useTomorrowButton){a("<a href='#' role='button'>"+H.__("calTomorrowButtonLabel")+"</a>").appendTo(C).addClass("ui-btn ui-btn-"+K.theme+" ui-icon-navigation ui-btn-icon-left ui-shadow ui-corner-all").on(K.clickEvent,function(i){i.preventDefault();H.theDate=H._pa([0,0,0],new H._date()).adj(2,1);H._t({method:"doset"})})}if(K.useClearButton){C.append(H._stdBtn.clear.apply(H))}if(K.useCollapsedBut){C.controlgroup({type:"horizontal"});C.addClass("ui-datebox-collapse")}else{C.controlgroup()}C.appendTo(y)}H.d.intHTML.on(K.clickEventAlt,"div."+d+"griddate",function(i){i.preventDefault();if(a(this).data("enabled")){H.theDate.setD(2,1).setD(1,a(this).jqmData("month")).setD(2,a(this).data("date"));H._t({method:"set",value:H._formatter(H.__fmt(),H.theDate),date:H.theDate});H._t({method:"close"})}});H.d.intHTML.on("swipeleft",function(){if(H.calNext){H._offset("m",1)}}).on("swiperight",function(){if(H.calPrev){H._offset("m",-1)}});if(H.wheelExists){H.d.intHTML.on("mousewheel",function(i,o){i.preventDefault();if(o>0&&H.calNext){H.theDate.setD(2,1);H._offset("m",1)}if(o<0&&H.calPrev){H.theDate.setD(2,1);H._offset("m",-1)}})}}})})(jQuery);