/*! DATEBOX/TIMEBOX/DURATIONBOX modes */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeButton:"a",themeInput:"a",useSetButton:true,validHours:false,repButton:true,durationStep:1,durationSteppers:{d:1,h:1,i:1,s:1}});a.extend(a.mobile.datebox.prototype,{_dbox_run:function(){var b=this,c=this.drag,d=150;if(c.cnt>10){d=100}if(c.cnt>30){d=50}if(c.cnt>60){d=20}if(c.cnt>120){d=10}if(c.cnt>240){d=3}c.didRun=true;c.cnt++;b._offset(c.target[0],c.target[1],false);b._dbox_run_update();b.runButton=setTimeout(function(){b._dbox_run()},d)},_dbox_fixstep:function(b){var c=this.options.durationSteppers,d=this.options.durationStep;if(a.inArray("s",b)>-1){c.i=1;c.s=d}if(a.inArray("i",b)>-1){c.h=1;c.s=d}if(a.inArray("h",b)>-1){c.d=1;c.s=d}},_dbox_run_update:function(f){var c=this,g=this.options,d=c.theDate.getTime()-c.initDate.getTime(),e=(g.mode==="durationbox"?true:false),b=c._dur(d<0?0:d);if(d<0){c.lastDuration=0;if(e){c.theDate.setTime(c.initDate.getTime())}}if(f!==true&&e!==true){c._check();if(g.mode==="datebox"){c.d.intHTML.find(".ui-datebox-header").find("h4").text(c._formatter(c.__("headerFormat"),c.theDate))}if(g.useSetButton){if(c.dateOK===false){c.setBut.addClass("ui-state-disabled")}else{c.setBut.removeClass("ui-state-disabled")}}}c.d.divIn.find("input").each(function(){switch(a(this).data("field")){case"y":a(this).val(c.theDate.get(0));break;case"m":a(this).val(c.theDate.get(1)+1);break;case"d":a(this).val((e?b[0]:c.theDate.get(2)));break;case"h":if(e){a(this).val(b[1])}else{if(c.__("timeFormat")===12){a(this).val(c.theDate.get12hr())}else{a(this).val(c.theDate.get(3))}}break;case"i":if(e){a(this).val(b[2])}else{a(this).val(c._zPad(c.theDate.get(4)))}break;case"M":a(this).val(c.__("monthsOfYearShort")[c.theDate.get(1)]);break;case"a":a(this).val(c.__("meridiem")[(c.theDate.get(3)>11)?1:0]);break;case"s":a(this).val(b[3]);break}});if(c.__("useArabicIndic")===true){c._doIndic()}},_dbox_vhour:function(g){var b=this,f=this.options,e,d=[25,0],c=[25,0];if(f.validHours===false){return true}if(a.inArray(b.theDate.getHours(),f.validHours)>-1){return true}e=b.theDate.getHours();a.each(f.validHours,function(){if(((e<this)?1:-1)===g){if(d[0]>Math.abs(this-e)){d=[Math.abs(this-e),parseInt(this,10)]}}else{if(c[0]>Math.abs(this-e)){c=[Math.abs(this-e),parseInt(this,10)]}}});if(d[1]!==0){b.theDate.setHours(d[1])}else{b.theDate.setHours(c[1])}},_dbox_enter:function(e){var d,b=this,c=0;if(e.data("field")==="M"){d=a.inArray(e.val(),b.__("monthsOfYearShort"));if(d>-1){b.theDate.setMonth(d)}}if(e.val()!==""&&e.val().toString().search(/^[0-9]+$/)===0){switch(e.data("field")){case"y":b.theDate.setD(0,parseInt(e.val(),10));break;case"m":b.theDate.setD(1,parseInt(e.val(),10)-1);break;case"d":b.theDate.setD(2,parseInt(e.val(),10));c+=(60*60*24)*parseInt(e.val(),10);break;case"h":b.theDate.setD(3,parseInt(e.val(),10));c+=(60*60)*parseInt(e.val(),10);break;case"i":b.theDate.setD(4,parseInt(e.val(),10));c+=(60)*parseInt(e.val(),10);break;case"s":c+=parseInt(e.val(),10);break}}if(this.options.mode==="durationbox"){b.theDate.setTime(b.initDate.getTime()+(c*1000))}b.refresh()}});a.extend(a.mobile.datebox.prototype._build,{timebox:function(){this._build.datebox.apply(this,[])},durationbox:function(){this._build.datebox.apply(this,[])},datebox:function(){var x,s,h,v,j=this,u=this.drag,p=this.options,q=(p.mode==="durationbox"?true:false),r=-2,l=["d","h","i","s"],e="ui-datebox-",c=a("<div>"),t=a("<fieldset>"),b=c.clone(),k=t.clone(),m=c.clone(),d=a("<div><input type='text'></div>").addClass("ui-input-text ui-body-"+p.themeInput+" ui-corner-all ui-mini ui-shadow-inset"),n=a("<div></div>"),f="ui-btn-inline ui-link ui-btn ui-btn-"+p.themeButton+" ui-btn-icon-notext ui-shadow ui-corner-all";if(typeof j.d.intHTML!=="boolean"){j.d.intHTML.empty().remove()}j.d.headerText=((j._grabLabel()!==false)?j._grabLabel():((p.mode==="datebox")?j.__("titleDateDialogLabel"):j.__("titleTimeDialogLabel")));j.d.intHTML=a("<span>");j.fldOrder=((p.mode==="datebox")?j.__("dateFieldOrder"):((q)?j.__("durationOrder"):j.__("timeFieldOrder")));if(!q){j._check();j._minStepFix();j._dbox_vhour(typeof j._dbox_delta!=="undefined"?j._dbox_delta:1)}else{j.dateOK=true;j._dbox_fixstep(j.fldOrder)}if(p.mode==="datebox"){a("<div class='"+e+"header'><h4>"+j._formatter(j.__("headerFormat"),j.theDate)+"</h4></div>").appendTo(j.d.intHTML)}for(s=0;s<j.fldOrder.length;s++){v=j._gridblk.b[s];if(q){x=p.durationSteppers[j.fldOrder[s]]}else{if(j.fldOrder[s]==="i"){x=p.minuteStep}else{x=1}}if(j.fldOrder[s]!=="a"||j.__("timeFormat")===12){a("<div>").append((q)?"<label>"+j.__("durationLabel")[a.inArray(j.fldOrder[s],l)]+"</label>":"").addClass("ui-block-"+v).appendTo(m);a("<div>").append(j._makeEl(d,{attr:{field:j.fldOrder[s],amount:x}})).addClass("ui-block-"+v).appendTo(b).find("input").data({field:j.fldOrder[s],amount:x});j._makeEl(n,{attr:{field:j.fldOrder[s],amount:x}}).addClass(e+"cbut ui-block-"+v+" ui-icon-plus "+f).appendTo(t).prepend((q)?"<label>"+j.__("durationLabel")[s]+"</label>":"");j._makeEl(n,{attr:{field:j.fldOrder[s],amount:x*-1}}).addClass(e+"cbut ui-block-"+v+" ui-icon-minus "+f).appendTo(k);r++}}if(q){m.addClass("ui-datebox-dboxlab ui-grid-"+j._gridblk.b[r]).appendTo(j.d.intHTML)}t.addClass("ui-grid-"+j._gridblk.b[r]).appendTo(j.d.intHTML);b.addClass("ui-datebox-dboxin ui-grid-"+j._gridblk.b[r]).appendTo(j.d.intHTML);k.addClass("ui-grid-"+j._gridblk.b[r]).appendTo(j.d.intHTML);j.d.divIn=b;j._dbox_run_update(true);if(j.dateOK!==true){b.find("input").addClass("ui-state-disable")}else{b.find(".ui-state-disable").removeClass("ui-state-disable")}if(p.useSetButton||p.useClearButton){h=a("<div>",{"class":e+"controls"});if(p.useSetButton){j.setBut=j._stdBtn.close.apply(j,[(p.mode==="datebox")?j.__("setDateButtonLabel"):(q)?j.__("setDurationButtonLabel"):j.__("setTimeButtonLabel")]);j.setBut.appendTo(h)}if(p.useClearButton){h.append(j._stdBtn.clear.apply(j))}if(p.useCollapsedBut){h.controlgroup({type:"horizontal"});h.addClass("ui-datebox-collapse")}else{h.controlgroup()}h.appendTo(j.d.intHTML)}if(!p.repButton){j.d.intHTML.on(p.clickEvent,"."+e+"cbut",function(g){b.find(":focus").blur();g.preventDefault();j._dbox_delta=(a(this).data("amount")>1)?1:-1;j._offset(a(this).data("field"),a(this).data("amount"))})}b.on("change","input",function(){j._dbox_enter(a(this))});if(j.wheelExists){b.on("mousewheel","input",function(g,i){g.preventDefault();j._dbox_delta=i<0?-1:1;j._offset(a(this).data("field"),((i<0)?-1:1)*a(this).data("amount"))})}if(p.repButton){j.d.intHTML.on(u.eStart,"."+e+"cbut",function(){b.find(":focus").blur();v=[a(this).data("field"),a(this).data("amount")];u.move=true;u.cnt=0;j._dbox_delta=(a(this).data("amount")>1)?1:-1;j._offset(v[0],v[1],false);j._dbox_run_update();if(!j.runButton){u.target=v;j.runButton=setTimeout(function(){j._dbox_run()},500)}});j.d.intHTML.on(u.eEndA,"."+e+"cbut",function(g){if(u.move){g.preventDefault();clearTimeout(j.runButton);j.runButton=false;u.move=false}})}}})})(jQuery);