/*! CUSTOMFLIP Mode */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeOptPick:"b",themeOpt:"a",useSetButton:true,customData:[],customDefault:[0,0,0],customDataLen:25,customFormat:false,customHead:false,customfliplang:{customSet:"Looks Good"}});a.extend(a.mobile.datebox.prototype,{_customflipDoSet:function(){var b=this,c=this.options;if(typeof b.customCurrent==="undefined"){b.customCurrent=this._makeDate(this.d.input.val())}b._t({method:"set",value:b._formatter(c.customFormat,b.customCurrent),custom:b.customCurrent})},_cubox_offset:function(e,d){var b=this,c,f=this.options;c=(b.customCurrent[e]+d)%f.customData[e].data.length;if(c<0){c=f.customData[e].data.length+c}b.customCurrent[e]=c;if(f.useImmediate){b._t({method:"set",value:b._formatter(f.customFormat,b.customCurrent),custom:b.customCurrent})}b.refresh()},_cubox_arr:function(g,d){var f=g,c,b=this.options.customDataLen,e=g.slice(0,d),h=g.slice(d+1);while(e.length<b){for(c=f.length;c>0;c--){e.unshift(f[c-1])}}while(e.length>b){e.shift()}while(h.length<b){for(c=0;c<f.length;c++){h.push(f[c])}}h.length=b;e.push(g[d]);return a.merge(a.merge([],e),h)},_cubox_range:function(b){return b?this._cubox_range(b-1).concat(b):[]},_cubox_pos:function(){var e,g,f,c,b=this,d=this.d.intHTML.find(".ui-datebox-flipcontent").innerHeight();b.d.intHTML.find(".ui-datebox-flipcenter").each(function(){g=a(this);f=g.innerHeight();g.css("top",((d/2)-(f/2)-3)*-1)});b.d.intHTML.find("ul").each(function(){g=a(this);d=g.parent().innerHeight();f=g.find("li").first();c=g.find("li").last().offset().top-g.find("li").first().offset().top;e=(((c-d)/2)+f.outerHeight())*-1;f.css("marginTop",e)})}});a.extend(a.mobile.datebox.prototype._parser,{customflip:function(g){var b=this.options,c=b.customFormat,i,h,e,d,f=[0,0,0,0,0,0];if(typeof(c)!=="string"){c=""}c=c.replace(/%X([0-5a-f])/gi,function(k,l){switch(l){case"a":case"b":case"c":case"d":case"e":case"f":return"("+k+"|.+?)";case"0":case"1":case"2":case"3":case"4":case"5":return"("+k+"|[0-9]+)";default:return".+?"}});c=new RegExp("^"+c+"$");i=c.exec(g);h=c.exec(b.customFormat);if(i!==null){for(var j=1;j<i.length;j++){e=h[j].charAt(2);if(isNaN(parseInt(e))){d=a.inArray(e,["a","b","c","d","e","f"]);f[d]=a.inArray(i[j],b.customData[d].data)}else{f[parseInt(e)-1]=parseInt(i[j])}}}return(g.length<1||f.length<1)?b.customDefault:f}});a.extend(a.mobile.datebox.prototype._customformat,{customflip:function(f,e,d){var b=parseInt(f),c;if(typeof(b)==="number"&&!isNaN(b)){return e[f-1]}else{c=a.inArray(f,["a","b","c","d","e","f"]);return d.customData[c].data[e[c]]}}});a.extend(a.mobile.datebox.prototype._build,{customflip:function(){var e,l,n,j,f,h,m=this,d=this.options,k="ui-datebox-",g=this._makeDate(this.d.input.val()),c=a("<div class='ui-overlay-shadow'><ul></ul></div>"),b=a("<div>",{"class":k+"flipcontent"});if(typeof m.customCurrent==="undefined"){m.customCurrent=g}if(typeof d.customData==="string"&&typeof window[d.customData]!=="undefined"){d.customData=window[d.customData]}if(d.customFormat===false){f=[];for(e=0;e<d.customData.length;e++){f.push("%X"+(e+1))}d.customFormat=f.join(",")}if(typeof m.d.intHTML!=="boolean"){m.d.intHTML.empty().remove()}else{m.d.input.on("datebox",function(o,i){if(i.method==="postrefresh"){m._cubox_pos()}})}m.d.headerText=((d.customHead!==false)?d.customHead:((m._grabLabel()!==false)?m._grabLabel():""));m.d.intHTML=a("<span>");a(document).one("popupafteropen",function(){m._fbox_pos()});m.fldOrder=m._cubox_range(d.customData.length);f=a("<div class='"+k+"header'>");if(d.customData.length>1){f.addClass("ui-grid-"+[0,0,"a","b","c"][d.customData.length])}for(l=0;l<d.customData.length;l++){a("<div>").addClass((d.customData.length>1)?"ui-block-"+["a","b","c","d"][l]:"").text(d.customData[l].name).css("textAlign","center").appendTo(f)}f.appendTo(m.d.intHTML);m.d.intHTML.append(b);for(l=0;l<d.customData.length;l++){h=m._cubox_arr(d.customData[l].data,m.customCurrent[l]);n=m._makeEl(c,{attr:{field:l,amount:1}});j=n.find("ul");if(d.customData.length===1){n.css("width","90%")}for(e=0;e<h.length;e++){f=(e!==d.customDataLen)?d.themeOpt:d.themeOptPick;console.log(e+" "+d.customDataLen);console.log(typeof e+" "+typeof d.customDataLen);a("<li>",{"class":"ui-body-"+f}).html("<span>"+h[e]+"</span>").appendTo(j)}n.appendTo(b)}a("<div>",{"class":k+"flipcenter ui-overlay-shadow"}).css("pointerEvents","none").appendTo(m.d.intHTML);if(d.useSetButton){l=a("<div>",{"class":k+"controls"});if(d.useSetButton){a("<a href='#' role='button'>").appendTo(l).text(m.__("customSet")).addClass("ui-btn ui-btn-"+d.theme+" ui-icon-check ui-btn-icon-left ui-shadow ui-corner-all").on(d.clickEventAlt,function(i){i.preventDefault();m._t({method:"set",value:m._formatter(d.customFormat,m.customCurrent),custom:m.customCurrent,});m._t({method:"close"})})}l.appendTo(m.d.intHTML)}if(m.wheelExists){m.d.intHTML.on("mousewheel",".ui-overlay-shadow",function(i,o){i.preventDefault();m._cubox_offset(a(this).data("field"),((o<0)?1:-1)*a(this).data("amount"))})}m.d.intHTML.on(m.drag.eStart,"ul",function(o,i){if(!m.drag.move){if(typeof i!=="undefined"){o=i}m.drag.move=true;m.drag.target=a(this).find("li").first();m.drag.pos=parseInt(m.drag.target.css("marginTop").replace(/px/i,""),10);m.drag.start=m.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;m.drag.end=false;o.stopPropagation();o.preventDefault()}})}});a.extend(a.mobile.datebox.prototype._drag,{customflip:function(){var b=this,d=this.options,c=this.drag;a(document).on(c.eMove,function(f){if(c.move&&d.mode==="customflip"){c.end=b.touch?f.originalEvent.changedTouches[0].pageY:f.pageY;c.target.css("marginTop",(c.pos+c.end-c.start)+"px");f.preventDefault();f.stopPropagation();return false}});a(document).on(c.eEnd,function(f){if(c.move&&d.mode==="customflip"){c.move=false;if(c.end!==false){f.preventDefault();f.stopPropagation();c.tmp=c.target.parent().parent();b._cubox_offset(c.tmp.data("field"),(parseInt((c.start-c.end)/c.target.innerHeight(),10)*c.tmp.data("amount")))}c.start=false;c.end=false}})}})})(jQuery);